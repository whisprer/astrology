name: Build Executables

on: 
  push:
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # DEBUG: Check if icon exists
      - name: Check icon file
        run: |
          if (Test-Path src/woflstrology.ico) {
            Write-Host "✓ Icon file found"
            Get-Item src/woflstrology.ico | Format-List
          } else {
            Write-Host "✗ Icon file NOT found"
          }
        shell: pwsh
      
      - run: pip install pyswisseph pytz geopy pyinstaller
      - run: pyinstaller --onefile --icon=src/woflstrology.ico --add-data "src/horoscope_database.json;." --name "WoflStrology-Windows" src/woflstrology-v0.4.0.py
      - uses: actions/upload-artifact@v4
        with:
          name: windows-build
          path: dist/WoflStrology-Windows.exe

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      # DEBUG: Check if icon exists
      - name: Check icon file
        run: |
          if [ -f src/woflstrology.icns ]; then
            echo "✓ Icon file found"
            ls -lh src/woflstrology.icns
          else
            echo "✗ Icon file NOT found"
          fi
      
      - run: pip install pyswisseph pytz geopy pyinstaller
      - run: pyinstaller --onefile --icon=src/woflstrology.icns --add-data "src/horoscope_database.json:." --name "WoflStrology-macOS" src/woflstrology-v0.4.0.py
      - run: chmod +x dist/WoflStrology-macOS
      - uses: actions/upload-artifact@v4
        with:
          name: macos-build
          path: dist/WoflStrology-macOS

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install pyswisseph pytz geopy pyinstaller
      - run: pyinstaller --onefile --add-data "src/horoscope_database.json:." --name "WoflStrology-Linux" src/woflstrology-v0.4.0.py
      - run: chmod +x dist/WoflStrology-Linux
      - uses: actions/upload-artifact@v4
        with:
          name: linux-build
          path: dist/WoflStrology-Linux
